<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Monad Tournament Bracket</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white min-h-screen flex flex-col items-center justify-start p-4">
  <h1 class="text-3xl font-bold mb-4">üèÜ Monad Tournament Bracket</h1>
  <div id="app" class="w-full max-w-6xl"></div>
  <footer class="mt-8 text-sm text-gray-400">
    Created by <a href="https://x.com/ega_2ez4crypto" class="underline">@ega_2ez4crypto</a>
  </footer>

  <script>
    const CONTRACT = "0xa10FC3954BC82F93dD6c19EBAB78289c912EA8d1";
    const TREASURY = "0x6c2AA81b02a940c04A570aFFe7a413ca54C625cf";

    let provider, signer, contract, account;
    let owner;

    const abi = [
      {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"roundNum","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"}],"name":"startTournament","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"roundNum","type":"uint256"},{"internalType":"uint256","name":"matchNum","type":"uint256"}],"name":"finishMatch","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"roundNum","type":"uint256"}],"name":"forceFinishExpiredMatches","outputs":[],"stateMutability":"nonpayable","type":"function"}
    ];

    const participants = ["LUMITERRA","KURU EXCHANGE","KIZZY MOBILE","CRYSTAL","CULT","aPriori","Magma","O.LAB"];

    async function connectWallet() {
      if (!window.ethereum) return alert("Please install MetaMask");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      account = await signer.getAddress();
      contract = new ethers.Contract(CONTRACT, abi, signer);
      owner = await contract.owner();
      render();
    }

    async function startTournamentUI() {
      const round = 1;
      const duration = 86400; // 24 hours
      try {
        const gasEstimate = await contract.estimateGas.startTournament(round, duration);
        const tx = await contract.startTournament(round, duration, { gasLimit: gasEstimate.mul(2) });
        await tx.wait();
        alert("Round 1 started: all 4 matches running concurrently for 24h!");
      } catch (e) { alert("Error: " + e.message); }
    }

    async function finishMatchUI() {
      const round = prompt("Round number:");
      const match = prompt("Match number:");
      try {
        const gasEstimate = await contract.estimateGas.finishMatch(round, match);
        const tx = await contract.finishMatch(round, match, { gasLimit: gasEstimate.mul(2) });
        await tx.wait();
        alert("Match finished!");
      } catch (e) { alert("Error: " + e.message); }
    }

    async function forceFinishExpiredMatchesUI() {
      const round = prompt("Round number:");
      try {
        const gasEstimate = await contract.estimateGas.forceFinishExpiredMatches(round);
        const tx = await contract.forceFinishExpiredMatches(round, { gasLimit: gasEstimate.mul(2) });
        await tx.wait();
        alert("Expired matches finished!");
      } catch (e) { alert("Error: " + e.message); }
    }

    function renderBracketUI() {
      return `
        <button onclick="connectWallet()" class='bg-blue-600 px-4 py-2 rounded mb-4'>Connect Wallet</button>
        <div class='grid grid-cols-4 gap-4 w-full'>
          <div class='flex flex-col justify-around'>
            ${participants.slice(0,4).map(p => `<div class='p-2 border rounded'>${p} <button class='ml-2 bg-blue-600 px-2 py-1 rounded'>Vote</button></div>`).join('')}
          </div>
          <div class='flex flex-col justify-around'><div class='p-2 border rounded'>Winner QF1</div><div class='p-2 border rounded'>Winner QF2</div></div>
          <div class='flex flex-col justify-around'><div class='p-2 border rounded'>Winner SF1</div></div>
          <div class='flex flex-col justify-around'><div class='p-2 border rounded'>üèÜ Champion</div></div>
        </div>
        <div class='grid grid-cols-4 gap-4 w-full mt-8'>
          <div class='flex flex-col justify-around'>
            ${participants.slice(4).map(p => `<div class='p-2 border rounded'>${p} <button class='ml-2 bg-blue-600 px-2 py-1 rounded'>Vote</button></div>`).join('')}
          </div>
          <div class='flex flex-col justify-around'><div class='p-2 border rounded'>Winner QF3</div><div class='p-2 border rounded'>Winner QF4</div></div>
          <div class='flex flex-col justify-around'><div class='p-2 border rounded'>Winner SF2</div></div>
        </div>
      `;
    }

    function render() {
      const path = window.location.pathname;
      const app = document.getElementById("app");
      app.innerHTML = "";

      if (path === "/admin") {
        if (!account) {
          app.innerHTML = `<button onclick="connectWallet()" class="bg-blue-600 px-4 py-2 rounded">Connect Wallet</button>`;
          return;
        }
        if (account.toLowerCase() !== owner.toLowerCase()) {
          app.innerHTML = `<p class='text-red-500'>Unauthorized: only owner can access admin panel.</p>`;
          return;
        }
        app.innerHTML = `
          <h2 class="text-2xl font-bold mb-4">‚öôÔ∏è Admin Panel</h2>
          <button onclick="startTournamentUI()" class="bg-green-600 px-4 py-2 rounded m-2">Start Round 1 (All 4 Matches, 24h)</button>
          <button onclick="finishMatchUI()" class="bg-yellow-600 px-4 py-2 rounded m-2">Finish Match</button>
          <button onclick="forceFinishExpiredMatchesUI()" class="bg-red-600 px-4 py-2 rounded m-2">Force Finish Expired Matches</button>
        `;
      } else {
        app.innerHTML = renderBracketUI() + `<br><a href='/admin' class='underline text-blue-400'>Go to Admin</a>`;
      }
    }

    render();
  </script>
</body>
</html>
